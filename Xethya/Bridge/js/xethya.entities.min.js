(function(){"use strict";Bridge.define("Xethya.Entities.EntityContainer",{statics:{config:{properties:{_Container:null}},initializeIfNeeded:function(){Bridge.hasValue(Bridge.get(Xethya.Entities.EntityContainer).get_Container())||Bridge.get(Xethya.Entities.EntityContainer).set_Container(new Bridge.Dictionary$2(String,Xethya.Entities.Entity)())},register:function(entity){if(entity.getIsVolatile())throw new Bridge.ArgumentException("The entity must be non-volatile in order to be registered in the Container. Set IsVolatile to true in order to do so");Bridge.get(Xethya.Entities.EntityContainer).get_Container().add(entity.getID(),entity)},lookup:function(guid){return Bridge.get(Xethya.Entities.EntityContainer).get_Container().get(guid)},__GetContainer:function(){return Bridge.global.__XETHYA_DEBUG__?Bridge.get(Xethya.Entities.EntityContainer).get_Container():null}}});Bridge.define("Xethya.Entities.Modifier",{config:{properties:{ID:null,Value:0,Source:null}}});Bridge.define("Xethya.Entities.Attribute",{inherits:[Xethya.Common.ValueInterval,Xethya.Common.Interfaces.INameable,Xethya.Common.Interfaces.IWithModifiers],_Value:Bridge.Decimal(0),config:{properties:{ID:null,Name:null,Modifiers:null}},constructor:function(name){Xethya.Common.ValueInterval.prototype.$constructor.call(this,0,100);this.setID(Bridge.get(Xethya.Common.Guid).generate());this.setName(name);this.setModifiers(new Bridge.List$1(Xethya.Entities.Modifier)())},constructor$1:function(name,valueRange){Xethya.Common.ValueInterval.prototype.$constructor.call(this,valueRange.getLowerBound(),valueRange.getUpperBound());this.setID(Bridge.get(Xethya.Common.Guid).generate());this.setName(name);this.setModifiers(new Bridge.List$1(Xethya.Entities.Modifier)())},getModifierSum:function(){return Bridge.Linq.Enumerable.from(this.getModifiers()).sum($_.Xethya.Entities.Attribute.f1)},getValue:function(){return this._Value},setValue:function(value){if(this.valueInRange(value))this._Value=value,this._RefreshBaseModifier();else throw new Bridge.ArgumentOutOfRangeException("Value","Attribute "+this.getName()+" has a value out of range "+Xethya.Common.ValueInterval.prototype.toString.call(this));},getComputedValue:function(){return this.getValue().add(Bridge.Decimal(this.getModifierSum()))},_RefreshBaseModifier:function(){var baseModifier=new Xethya.Entities.Modifier;baseModifier.setSource(null);baseModifier.setValue(Bridge.Convert.toInt32(this.getValue().div(Bridge.Decimal(15)).floor()));this.getModifiers().getCount()===0?this.getModifiers().add(baseModifier):this.getModifiers().setItem(0,baseModifier)}});var $_={};Bridge.ns("Xethya.Entities.Attribute",$_);Bridge.apply($_.Xethya.Entities.Attribute,{f1:function(m){return m.getValue()}});Bridge.define("Xethya.Entities.Entity",{inherits:[Xethya.Common.Interfaces.INameable,Xethya.Common.Interfaces.IWithAttributes,Xethya.Common.Interfaces.IWithModifiers],config:{properties:{ID:null,Name:null,IsVolatile:!1,Attributes:null,Modifiers:null}},constructor:function(){this.setID(Bridge.get(Xethya.Common.Guid).generate());this.setIsVolatile(!1);this.setAttributes(new Bridge.List$1(Xethya.Entities.Attribute)());this.setModifiers(new Bridge.List$1(Xethya.Entities.Modifier)());this._RegisterInContainerIfNeeded()},constructor$1:function(name){this.setID(Bridge.get(Xethya.Common.Guid).generate());this.setName(name);this.setIsVolatile(!1);this.setAttributes(new Bridge.List$1(Xethya.Entities.Attribute)());this.setModifiers(new Bridge.List$1(Xethya.Entities.Modifier)());this._RegisterInContainerIfNeeded()},getModifierSum:function(){return Bridge.Linq.Enumerable.from(this.getModifiers()).sum($_.Xethya.Entities.Entity.f1)},_RegisterInContainerIfNeeded:function(){this.getIsVolatile()||(Bridge.get(Xethya.Entities.EntityContainer).initializeIfNeeded(),Bridge.get(Xethya.Entities.EntityContainer).register(this))},getAttributeByName:function(attributeName){return Bridge.Linq.Enumerable.from(this.getAttributes()).first(function(a){return a.getName()===attributeName})}});Bridge.ns("Xethya.Entities.Entity",$_);Bridge.apply($_.Xethya.Entities.Entity,{f1:function(m){return m.getValue()}});Bridge.define("Xethya.Entities.Skill",{inherits:[Xethya.Entities.Attribute,Xethya.Common.Interfaces.IWithAttributes,Xethya.Common.Interfaces.IModifierSource],config:{properties:{Attributes:null}},constructor:function(name){Xethya.Entities.Attribute.prototype.$constructor.call(this,name);this.setAttributes(new Bridge.List$1(Xethya.Entities.Attribute)())},constructor$1:function(name,valueRange){Xethya.Entities.Attribute.prototype.constructor$1.call(this,name,valueRange);this.setAttributes(new Bridge.List$1(Xethya.Entities.Attribute)())},getAttributeByName:function(attributeName){return Bridge.Linq.Enumerable.from(this.getAttributes()).first(function(a){return a.getName()===attributeName})},$use:function(){var $t,st=new Xethya.DiceRolling.SkillThrow(Bridge.Convert.toInt32(this.getValue())),str=st.roll$2(),attribute,modifier;for(str.getModifiers().addRange(this.getModifiers()),$t=Bridge.getEnumerator(this.getAttributes());$t.moveNext();)attribute=$t.getCurrent(),modifier=new Xethya.Entities.Modifier,modifier.setSource("attribute@"+attribute.getID()),modifier.setValue(attribute.getModifierSum()),str.getModifiers().add(modifier);return str.getThrowType()===Xethya.DiceRolling.DiceThrowType.failure&&str.setFailureRoll(new Xethya.DiceRolling.ChanceThrow("constructor").roll$1()),str}});Bridge.define("Xethya.Entities.SkilledEntity",{inherits:[Xethya.Entities.Entity,Xethya.Common.Interfaces.IWithSkills],config:{properties:{Skills:null}},constructor:function(){Xethya.Entities.Entity.prototype.$constructor.call(this);this.setSkills(new Bridge.List$1(Xethya.Entities.Skill)())},constructor$1:function(name){Xethya.Entities.Entity.prototype.constructor$1.call(this,name);this.setSkills(new Bridge.List$1(Xethya.Entities.Skill)())},getSkillByName:function(skillName){return Bridge.Linq.Enumerable.from(this.getSkills()).first(function(s){return s.getName()===skillName})},useSkill:function(skillName){return this.getSkillByName(skillName).$use()}});Bridge.init()})(this);